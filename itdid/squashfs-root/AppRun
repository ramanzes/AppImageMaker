#!/bin/bash
# AppRun скрипт для портативного запуска приложения

HERE="$(dirname "$(readlink -f "${0}")")"

# Экспорт переменных окружения для поиска библиотек
export LD_LIBRARY_PATH="${HERE}/usr/lib:${HERE}/usr/lib/x86_64-linux-gnu:${LD_LIBRARY_PATH}"
export PATH="${HERE}/usr/bin:${PATH}"

# Qt переменные окружения
export QT_PLUGIN_PATH="${HERE}/usr/lib/qt5/plugins:${HERE}/usr/lib/plugins:${QT_PLUGIN_PATH}"
export QML2_IMPORT_PATH="${HERE}/usr/lib/qt5/qml:${QML2_IMPORT_PATH}"
export QT_QPA_PLATFORM_PLUGIN_PATH="${HERE}/usr/lib/qt5/plugins/platforms"

# GTK переменные окружения
export GTK_PATH="${HERE}/usr/lib/gtk-2.0:${HERE}/usr/lib/gtk-3.0:${GTK_PATH}"
export GTK_THEME_PATH="${HERE}/usr/share/themes:${GTK_THEME_PATH}"
export GTK_MODULE_PATH="${HERE}/usr/lib/gtk-3.0/modules:${GTK_MODULE_PATH}"

# XDG переменные окружения
export XDG_DATA_DIRS="${HERE}/usr/share:${XDG_DATA_DIRS}"
export XDG_CONFIG_DIRS="${HERE}/usr/etc/xdg:${XDG_CONFIG_DIRS}"

# KDE/Qt переменные
export KDEDIRS="${HERE}/usr:${KDEDIRS}"

# Переменные для поиска ресурсов
export APPDIR="${HERE}"

# Установка локали
export LC_NUMERIC=C

# Переходим в директорию приложения для корректной работы
cd "${HERE}"

# Проверяем существование исполняемого файла
if [[ ! -f "${HERE}/usr/bin/krusader" ]]; then
    echo "Ошибка: исполняемый файл не найден: ${HERE}/usr/bin/krusader"
    exit 1
fi

# Запускаем приложение с переданными аргументами
exec "${HERE}/usr/bin/krusader" "$@"
